var x=Object.create;var u=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var C=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var h=e=>u(e,"__esModule",{value:!0});var R=(e,i)=>{h(e);for(var r in i)u(e,r,{get:i[r],enumerable:!0})},F=(e,i,r)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of j(i))!U.call(e,t)&&t!=="default"&&u(e,t,{get:()=>i[t],enumerable:!(r=D(i,t))||r.enumerable});return e},n=e=>F(h(u(e!=null?x(C(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);R(exports,{default:()=>b});var w=typeof document=="undefined"?new(require("url")).URL("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href;var y=n(require("directory-tree")),o=n(require("path")),S=n(require("vite")),v=n(require("vite-with-bluejsx")),a=n(require("fs")),P=n(require("deepmerge")),_=n(require("url"));function b(e){var f;(0,v.default)(e);let i={},r=(0,o.resolve)(new _.URL(w).pathname,"../../");console.log(require.main,r);let t=(0,o.resolve)(r,"./pages"),p=(0,o.resolve)(r,"./.bluepages");a.default.mkdirSync(p,{recursive:!0});let k=(0,y.default)(t,{extensions:/\.(md|mdx|js|jsx|ts|tsx)$/,normalizePath:!0},({name:m},l)=>{let s=m.replace(/.[\w]+$/,"");if(s.indexOf("_")===0)return null;let d=(0,o.relative)(r+"/pages",l),c=(0,o.resolve)(p+"/"+d,"../");a.default.mkdirSync(c,{recursive:!0});let g=(0,o.resolve)(c,`./${s}.html`);a.default.writeFileSync((0,o.resolve)(c,`./${s}.js`),`import Component from '${(0,o.relative)(c,l)}';import('${(0,o.relative)(c,t)}/_app').then(({default: Page})=>document.querySelector('#app').appendChild(Page({Component,pageProps:{}})))`);let $=a.default.readFileSync(`${t}/_template.html`,"utf-8").replace("</body",`<script type="module" src="./${s}.js"><\/script></body`);a.default.writeFileSync(g,$),i[d.replace(/\//,"_").replace(/.[\w]+$/,"")]=g});return(f=e.plugins)!=null||(e.plugins=[]),e.plugins.push({name:"with-pages-listen-dir",async configureServer(m){let{watcher:l}=m;l.add(t),l.on("add",(s,d)=>{s.includes(t)&&L(m)})}}),(0,P.default)(e,{build:{rollupOptions:{input:i},emptyOutDir:!0,outDir:(0,o.relative)(p,(0,o.resolve)(r,"./dist"))},root:p,publicDir:r+"/public"})}async function L(e){global.__vite_start_time=Date.now();let{port:i}=e.config.server;await e.close();let r=null;try{r=await(0,S.createServer)(e.config.inlineConfig)}catch(t){e.config.logger.error(t.message,{timestamp:!0});return}for(let t in r)t!=="app"&&(e[t]=r[t]);e.config.server.middlewareMode?e.config.logger.info("server restarted.",{timestamp:!0}):await e.listen(i,!0)}0&&(module.exports={});
